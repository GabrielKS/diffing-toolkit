defaults:
  - organism: first_letter_anoz
  - model: olmo2_1B
  - diffing/method: activation_difference_lens
  - infrastructure: runpod
  - diffing/grading_rubrics
  - diffing/evaluation
  - _self_

# General datasets (used across all organisms/experiments)
chat_dataset:
  id: science-of-finetuning/tulu-3-sft-olmo-2-mixture
  splits: [train, validation]
  is_chat: true
  text_column: null

pretraining_dataset:
  id: science-of-finetuning/fineweb-1m-sample
  splits: [train, validation]
  is_chat: false
  text_column: text

# Pipeline control
pipeline:
  mode: full
  output_dir: ${infrastructure.storage.base_dir}/hydra/${now:%Y-%m-%d}/${now:%H-%M-%S}

# Preprocessing configuration (global settings)
preprocessing:
  activation_store_dir: ${infrastructure.storage.base_dir}/activations
  layers: [0.5, 0.94, 1.0]
  max_samples_per_dataset: 200000
  max_tokens_per_dataset_train: 50_000_000
  max_tokens_per_dataset_validation: 5_000_000
  batch_size: 32
  context_len: 1024
  dtype: bfloat16
  store_tokens: true
  overwrite: false
  disable_multiprocessing: true
  chat_only: false
  pretraining_only: false
  training_only: false

# Global settings
seed: 42
debug: false
verbose: true
torch_precision: high
hf_name: model-organisms-for-real

# Diffing configuration
diffing:
  results_base_dir: ${infrastructure.storage.base_dir}/diffing_results
  results_dir: ${diffing.results_base_dir}/${model.name}/${organism.name}_${organism_variant}
  gpu_memory_utilization: 0.95
  method:
    layers:
      - 0.5
      - 0.94
      - 1.00
    batch_size: 32
    causal_effect:
      enabled: false
    steering:
      enabled: false
    token_relevance:
      enabled: false
    auto_patch_scope:
      tasks:
        - dataset: science-of-finetuning/tulu-3-sft-olmo-2-mixture
          layer: 0.5
          positions: [-3, -2, -1, 0, 1, 2, 3, 4, 5]
        - dataset: science-of-finetuning/tulu-3-sft-olmo-2-mixture
          layer: 0.94
          positions: [-3, -2, -1, 0, 1, 2, 3, 4, 5]
        - dataset: science-of-finetuning/tulu-3-sft-olmo-2-mixture
          layer: 1.0
          positions: [-3, -2, -1, 0, 1, 2, 3, 4, 5]

# Variant selection
organism_variant: wide

# Hydra specific
hydra:
  run:
    dir: ${pipeline.output_dir}
  sweep:
    dir: multirun/${now:%Y-%m-%d}/${now:%H-%M-%S}

# Wandb configuration
wandb:
  enabled: true
  entity: "therootof3"
